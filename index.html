<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Equipment Maintenance</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <style>
    table.dataTable td, table.dataTable th {
      white-space: nowrap;
    }
    input, textarea {
      width: 100%;
    }
    .form-row {
      margin-bottom: 10px;
    }
    .form-container {
      margin-bottom: 20px;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 10px;
      width: 100%;
      max-width: 1400px;
    }
    .form-container h3 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <h2>üìã Equipment Maintenance</h2>

  <!-- Form Input -->
  <div class="form-container">
    <h3>‚ûï Add New Entry</h3>
    <div class="form-row">
      <label>Activity: <input type="text" id="activity" /></label>
      <label>Equip: <input type="text" id="equip" /></label>
      <label>Model: <input type="text" id="model" /></label>
      <label>Downtime (yyyy-mm-dd): <input type="date" id="downtime" /></label>
    </div>
    <div class="form-row">
      <label>Comp Code: <input type="text" id="compCode" /></label>
      <label>Resp: <input type="text" id="resp" /></label>
    </div>
    <div class="form-row">
      <label>Remaks: <textarea id="remaks" rows="2"></textarea></label>
      <label>Est RFU (yyyy-mm-dd): <input type="date" id="estRfu" /></label>
    </div>
    <button onclick="addRow()">Add</button>
  </div>

  <!-- Table -->
  <table id="maintenanceTable" class="display nowrap" style="width:100%">
    <thead>
      <tr>
        <th>No</th>
        <th>Activity</th>
        <th>Equip</th>
        <th>Model</th>
        <th>Downtime *</th>
        <th>Comp Code</th>
        <th>Status</th>
        <th>Status Gb</th>
        <th>Resp</th>
        <th>Remaks</th>
        <th>Est RFU</th>
        <th>Aging</th>
        </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let table;

    function calculateAging(downtimeStr) {
      if (!downtimeStr) return '';
      const now = new Date();
      const downtime = new Date(downtimeStr);
      const diff = Math.floor((now - downtime) / (1000 * 60 * 60 * 24));
      return diff >= 0 ? diff : 0;
    }

    function addRow() {
      const activity = $('#activity').val();
      const equip = $('#equip').val();
      const model = $('#model').val();
      const downtime = $('#downtime').val();
      const compCode = $('#compCode').val();
      const resp = $('#resp').val();
      const remaks = $('#remaks').val().replace(/\n/g, '<br>');
      const estRfu = $('#estRfu').val();
      const aging = calculateAging(downtime);

      table.row.add([
        '', activity, equip, model, downtime, compCode, status,
        statusGb, resp, remaks, estRfu, aging,
        `<button onclick="editRow(this)">‚úèÔ∏è</button> <button onclick="deleteRow(this)">üóëÔ∏è</button>`
      ]).draw(false);

      // Clear inputs
      $('input, textarea').val('');
    }

    function deleteRow(btn) {
      const row = $(btn).closest('tr');
      table.row(row).remove().draw();
    }

    function editRow(btn) {
      const row = $(btn).closest('tr');
      const data = table.row(row).data();
      const values = prompt("Edit data (pisahkan dengan tanda '|'):\n" +
        "Activity|Equip|Model|Downtime|CompCode|Status|StatusGb|Resp|Remaks|EstRFU", 
        data.slice(1, 11).join('|'));
      if (values) {
        const arr = values.split('|');
        const aging = calculateAging(arr[3]);
        table.row(row).data([
          data[0], ...arr, aging,
          `<button onclick="editRow(this)">‚úèÔ∏è</button> <button onclick="deleteRow(this)">üóëÔ∏è</button>`
        ]).draw(false);
      }
    }

    $(document).ready(function () {
      table = $('#maintenanceTable').DataTable({
        responsive: true,
        columnDefs: [{
          targets: 0,
          orderable: false,
          searchable: false,
          render: function (data, type, row, meta) {
            return meta.row + 1;
          }
        }]
